# Chapter 04 - 테스트 구축하기
리팩토링을 제대로 하려면 불가피하게 저지르는 실수를 잡아주는 견고한 테스트 스위트(test suite)가 뒷받침돼야 한다. 리팩토링을 하지 않더라도 좋은 테스트를 작성하는 일은 개발 효율을 높여준다.

</br>

## 자가 테스트 코드의 가치
모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자.

테스트 스위트(test suite)는 강력한 버그 검출 도구로, 버그를 찾는 데 걸리는 시간을 대폭 줄여준다.

테스트를 작성하기 가장 좋은 시점을 프로그래밍을 시작하기 전이다. 

</br>

### 테스트 코드 작성의 장점
- 테스트를 작성하다 보면 원하는 기능을 추가하기 위해 무엇이 필요한지 고민하게 된다.
- 구현보다 인터페이스에 집중하게 된다. 
- 코딩이 완료되는 시점을 정확하게 판단할 수 있다. (테스트를 모두 통과한 시점이 바로 코드를 완성한 시점이다)

</br>

## 첫번째 테스트
실패해야 할 상황에서는 반드시 실패하게 만들자.

자주 테스트하라. 작성중인 코드는 최소한 몇 분 간격으로 테스트하고, 적어도 하루에 한 번은 전체 테스트를 돌려보자.

</br>

## 테스트 추가하기
테스트는 위험 요인을 중심으로 작성해야 한다. 테스트의 목적은 어디까지나 현재 혹은 향후에 발생하는 버그를 찾는 데 있다. 

완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는 게 낫다. 

테스트끼리 상호작용하게 하는 공유 픽스처를 생성하는 것은 좋지 않다.

테스트를 실행하는 순서에 따라 결과가 달라질 수 있다.

매번 새로운 픽스처를 만드는 것이 좋다.

테스트들이 모두 똑같은 픽스처에 기초하여 검증을 수행해야 한다. 그래야 표준 픽스처에 익숙해져서 테스트할 속성을 다양하게 찾아낼 수 있기 때문이다. 

beforeEach 블록은 표준 픽스처를 사용한다는 사실을 알려준다. 그러면 코드를 읽는 사람입장에서 해당 descibe 블록 안의 모든 테스트가 똑같은 기준 데이터로부터 시작한다는 사실을 쉽게 알 수 있다.

</br>

## 픽스처 수정하기
일반적으로 it 구문 하나당 검증도 하나씩만 하는게 좋다.

</br>

## 경계 조건 검사하기 

범위를 벗어나는 경계 지점에서 문제가 생기면 어떤 일이 벌어지는지 확인하는 테스트도 작성하면 좋다. (예를들어 양의 정수만 들어가야 하는 곳에 문자나 "0" 을 넣는 등)

문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트하자.

어차피 모든 버그를 잡아낼 수는 없다고 생각하여 테스트를 작성하지 않는다면 대다수의 버그를 잡을 수 있는 기회를 날리는 셈이다.

위험한 부분에 집중하는 것이 좋다. 코드에서 처리 과정이 복잡한 부분이나 함수에서 오류가 생길만한 부분을 찾아보자. 테스트가 모든 버그를 걸러주지는 못해도 안심하고 리팩토링할 수 있는 보호막정도는 되어준다. 리팩토링을 하면서 프로그램을 더욱 깊이 이해하게 되어 더 많은 버그를 찾게된다.

테스트 스위트부터 갖춘 뒤에 리팩토링을 하고, 리팩토링하는 동안에도 계속해서 테스트를 추가하는 것이 좋다.

</br>

## 끝나지 않은 여정
테스트는 리팩토링에 필요한 토대일 뿐만 아니라, 그 자체로도 프로그래밍에 중요한 역할을 한다.

단위 테스트란 코드의 작은 영역만을 대상으로 빠르게 설계된 테스트다.

기능을 새로 추가할 때 마다 테스트도 추가하는 것은 물론, 기존 테스트도 다시 살펴보자.

버그를 발견하는 즉시 발견한 버그를 명확히 잡아내는 테스트부터 작성하는 습관을 들이자.

버그 리포트를 받으면 가장 먼저 그 버그를 드러내는 단위 테스트부터 작성하자.